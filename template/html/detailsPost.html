{{define "content"}}
<div class="p-4 md:p-8 bg-[#90b0cb] min-h-screen">
      <div class="max-w-6xl mx-auto flex flex-col md:flex-row gap-6">
        {{range .Post}}
        <div class="bg-[#6d91ac] rounded-md p-4 w-full md:w-1/3 text-white shadow">
          <div class="flex justify-between items-center mb-2 text-sm">
            <div class="flex items-center gap-2">
              {{ if ne .Pseudo "Anonym"}}
              <a href="/profile?userId={{.CreatorId}}" class="flex items-center gap-2">
                <div class="w-6 h-6 rounded-full bg-gray-300"></div>
                <span class="font-semibold">{{.Pseudo}}</span>
              </a>
              {{else}}
                <div class="w-6 h-6 rounded-full bg-gray-300"></div>
                <span class="font-semibold">{{.Pseudo}}</span>
              {{end}}
            </div>
            <div class="text-xs text-right">{{.DateD}}<br />{{.DateH}}</div>
          </div>
          <div class="bg-white text-black text-center font-bold py-8 my-4 rounded-md">
            {{.Title}}
          </div>
          <div id="content" class="border-l border-white pl-2 text-sm" {{if eq .CreatorId $.User}} contenteditable="true" {{end}}>  
            {{.Content}}
          </div>
          {{if eq .CreatorId $.User}}
          <button style="background-color: transparent; border: none; cursor: pointer;" onclick="savePost()">Modifier</button> 
          {{end}} 
        </div>

        <div class="flex-1 space-y-4">
          <div class="bg-white rounded-md shadow p-4 space-y-4">
          {{range .Comment}}
            <div class="flex items-start gap-2 border border-gray-600 rounded-md p-2">
              <div>
                <div class="flex items-center gap-2">
                  {{ if ne .Pseudo "Anonym"}}
                  <a href="/profile?userId={{.CreatorId}}" class="flex items-center gap-2">
                    <div class="w-6 h-6 rounded-full bg-gray-300"></div>
                    <span class="font-semibold">{{.Pseudo}}</span>
                  </a>
                  {{else}}
                  <div class="w-6 h-6 rounded-full bg-gray-300"></div>
                  <span class="font-semibold">{{.Pseudo}}</span>
                  {{end}}
                </div>
                <div id="comment-{{.Id}}" class="border-l border-white pl-2 text-sm" {{if eq .CreatorId $.User}} contenteditable="true" {{end}}>
                  {{.Content}}
                </div>
              </div>
              {{if eq .CreatorId $.User}}
                <button style="background-color: transparent; border: none; cursor: pointer;" onclick="saveComment({{.Id}})">Modifier</button> 
                <button style="background-color: transparent; border: none; cursor: pointer;" onclick="deleteCom({{.Id}})">Supprimer</button>
              {{end}}
            </div>
            {{end}}
          </div>
        </div>
        {{end}}
      </div>

      {{if ne .User ""}}
      <form id="chat" method="post" action="/detailPost?postId={{range .Post}}{{.Id}}{{end}}&message=true">
        <div class="mt-2 max-w-6xl mx-auto flex gap-2">
          <input
          type="text"
          id="message"
          name="message"
          placeholder="Send a message .."
          class="flex-1 rounded-full px-4 py-2 bg-white text-sm shadow border focus:outline-none"
          />
          <button type="submit" 
          class="bg-[#e2d3b7] hover:bg-[#d8c7aa] text-slate-800 font-semibold px-4 py-2 rounded-full transition">
            Envoyer
          </button>
        </div>
      </form>
      {{end}}

      {{range .Post}}
        {{if eq .CreatorId $.User}}
          <Button onclick = supp()
          name="supp">
          supprimer 
          </Button>
        {{end}}
      {{end}}

      <script>

      

        function supp(){
          document.getElementById('message').value='supp'
          document.getElementById('chat').submit()
        }

         function savePost() {
    const content = document.getElementById('content').innerText;

    fetch('/updatePost', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
        {{range .Post}}
      body: JSON.stringify({ id: {{.Id}}, text: content }) {{end}}
      })
    .then(response => {
      if (response.ok) {
        alert("Post mis à jour !");
      } else {
        alert("Erreur lors de la mise à jour.");
      }
    });
  }

        function saveComment(commentId) {
          event.preventDefault();
  const content = document.getElementById('comment-' + commentId).innerText;
  fetch('/updateComment', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json'
    },
    body: JSON.stringify({ id: commentId, text: content })
  })
  .then(response => {
    if (response.ok) {
      alert("Commentaire mis à jour !");
      window.location.href = '/detailPost?postId={{range .Post}}{{.Id}}{{end}}&message=false';
    } else {
      alert("Erreur lors de la mise à jour.");
    }
  });
}

function deleteCom(id){
  fetch("/deleteCom",{
    method: 'POST',
    headers: {
      "Content-Type" : "application/json"
    },
    body: JSON.stringify({id:id})
  }).then(reponse => {
    if (reponse.ok){
      alert("Commentaire Delete")
      window.location.href = '/detailPost?postId={{range .Post}}{{.Id}}{{end}}&message=false';
    } else {
      alert("Erreur lors du delet")
    }
  })
}

      </script>

    </div>
 {{end}}